<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Camera } from './camera'
import { Input } from './input'

const PIXI = require('pixi.js')
require('./pixi-layers')

export * from './input.js'
export * from './room.js'
export * from './gameobject.js'
export * from './tilemap.js'
export * from './tilelayer.js'
export * from './utils.js'

/** Game Class  */
export class Game {
  constructor (newWidth, newHeight) {
    console.log('rpgbaker use pixi version ' + PIXI.VERSION)

    this.rooms = new Map()
    this.layers = new Map()
    this.groups = new Map()

    this.app = new PIXI.Application({
      width: newWidth, // default: 800
      height: newHeight, // default: 600
      antialias: false, // default: false
      transparent: false, // default: false
      resolution: 1 // default: 1
    })

    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST

    this.groups.set('0', new PIXI.display.Group(0, false))
    this.groups.set('1', new PIXI.display.Group(1, false))

    this.app.stage = new PIXI.display.Stage()
    this.app.stage.group.enableSort = true

    this.layers.set('0', new PIXI.display.Layer(this.groups.get('0')))
    this.layers.set('1', new PIXI.display.Layer(this.groups.get('1')))

    this.app.stage.addChild(this.layers.get('0'))
    this.app.stage.addChild(this.layers.get('1'))

    // Add the canvas that Pixi automatically created for you to the HTML document
    document.body.appendChild(this.app.view)

    this.currentRoomKey = ''
    this.nextRoomKey = ''

    this.camera = new Camera(this)
    this.input = new Input()

    this.OnLoadedDone = this.OnLoadedDone.bind(this)
  }
  Init () {
    // load an image and run the `setup` function when it's done
    PIXI.loader.load(this.OnLoadedDone)

    // Maybe one day this.input.Init()
  }

  OnLoadedDone () {
    // Start the game loop
    console.log('OnLoadedDone')
    // for (let [key, val] of this.rooms.entries()) {
    //   console.debug(key)
    //   val.Init()
    // }

    this.app.ticker.add(delta => this.Update(delta))
  }

  /**
   * Add a new Room to the list of rooms
   * @param {string} roomKey - The Room key name
   * @param {Room} roomToAdd - The room object itself
   */
  AddRoom (roomKey, roomToAdd) {
    this.app.stage.addChild(roomToAdd)
    this.rooms.set(roomKey, roomToAdd)
    this.rooms.get(roomKey).visible = false
    roomToAdd.game = this
  }

  /**
   * Goto to a specific room
   * @param {string} roomKey - The Room name
   */
  RoomGoto (roomKey) {
    this.nextRoomKey = roomKey
  }

  CheckRoomTransition () {
    if (this.currentRoomKey !== this.nextRoomKey) {
      let oldRoom = this.rooms.get(this.currentRoomKey)
      let newRoom = this.rooms.get(this.nextRoomKey)
      if (oldRoom) {
        oldRoom.TransferPersistentObjectsTo(newRoom)
        oldRoom.Destroy()
      }
      this.currentRoomKey = this.nextRoomKey
      newRoom.Init()
      for (let [, val] of this.rooms.entries()) {
        val.visible = false
      }
      newRoom.visible = true
    }
  }
  Update (delta) {
    // message.setText(Math.round(app.ticker.FPS))
    this.input.Update()
    this.camera.Update(delta)
    this.CheckRoomTransition()
    for (let [key, val] of this.rooms.entries()) {
      // TODO change this
      if (key === this.currentRoomKey) {
        val.Update(delta)
      }
    }
  }

  GetCurrentRoom () {
    return this.rooms.get(this.currentRoomKey)
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Camera.html">Camera</a></li><li><a href="Game.html">Game</a></li><li><a href="Input.html">Input</a></li><li><a href="Room.html">Room</a></li><li><a href="TileLayer.html">TileLayer</a></li><li><a href="TileMap.html">TileMap</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-tutorial-room.html">tutorial-room</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Nov 16 2018 17:25:30 GMT+0100 (Romance Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
